---
title: Agent Options
weight: 3
---

Set these options at the agent level in the `kubesvc.yaml` configuration file. If deploying as a non Spinnaker service, you will likely need to specify `clouddriver.grpc` endpoint (e.g. `grpc.spinnaker.example.com:443`).

## Kubernetes Account
At a minimum you will need to add an account, give it a name and set its Spinnaker permissions.

### Spinnaker Service/Infrastructure Mode

In this mode, you set up multiple accounts per agent, your configuration will look like:

```yaml
kubernetes:
  accounts:
    - name: account-01
      kubeconfigFile: /kubeconfigfiles/kubecfg-account01.yaml
    - ...  
```

> If you are migrating accounts from Clouddriver, you can just copy the same block of configuration here. Unused properties are ignored.


### Agent Mode
In agent mode, you configuration will probably look like:

```yaml
kubernetes:
  accounts:
    - name: account-01
      serviceAccount: true
```


## Options

| Settings                                                                                                                                                                    | Type              | Default                 | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| --------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------- | ----------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `clouddriver.grpc`                                                                                                                                                          | string (hostname) | `spin-clouddriver-grpc:9091` | Hostname of the Clouddriver endpoint  |
| `clouddriver.insecure`  | boolean           | false                   | If true, we’re connecting to a non TLS server                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| `logging.file`                                                                                                                                                              | string            | stdout if not defined   | File to save logs to                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| `logging.level`                                                                                                                                                             | string            | `INFO`                  | Log level. Can be any of (case insensitive):<br>`panic`, `fatal` , `error`, `warn` (or `warning`),  `info`, `debug`, `trace`                                                                                                                                                                                                                                                                                                                                                                    |
| `kubernetes.reconnectTimeoutMs`                                                                                                                                             | integer           | 5000                    |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| `kubernetes.accounts[].name`                                                                                                                                                | string            | none, required          | Name of the Kubernetes cluster in Spinnaker. Spinnaker still needs to accept that name.                                                                                                                                                                                                                                                                                                                                                                                                         |
| `kubernetes.accounts[].kubeConfigFile`                                                                                                                                      | string            | none                    | Path to the kubeconfig file                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| `kubernetes.accounts[].insecure`                                                                                                                                            | boolean           | false                   | Do not verify the TLS certificate of the Kubernetes API server<br>Don’t use without a good reason.                                                                                                                                                                                                                                                                                                                                                                                              |
| `kubernetes.accounts[].context`                                                                                                                                             | string            | empty                   | If provided, will use the given context of the configured kubeconfig                                                                                                                                                                                                                                                                                                                                                                                                                            |
| `kubernetes.accounts[].oAuthScopes`                                                                                                                                         | []string          | empty                   | List of OAuth scope when authenticating with gcp provider<br>https://cloud.google.com/kubernetes-engine/docs/how-to/cluster-access-for-kubectl#authentication                                                                                                                                                                                                                                                                                                                                   |
| `kubernetes.accounts[].serviceAccount`                                                                                                                                      | boolean           | false                   | If true and kubesvc runs in Kubernetes - use the current service account to call to the current API server. In that mode, you don’t need to provide a kubeconfig file.                                                                                                                                                                                                                                                                                                                          |
| `kubernetes.accounts[].namespaces`                                                                                                                                          | []string          | empty                   | Whitelist of namespaces similar to Clouddriver’s.<br>This comes at a great cost of multiplying the resources by the number of namespaces.<br>NOT IMPLEMENTED                                                                                                                                                                                                                                                                                                                                    |
| `kubernetes.accounts[].omitNamespaces`                                                                                                                                      | []string          | empty                   | Blacklist of namespaces <br>This comes at a great cost of multiplying the resources by the number of namespaces.<br>NOT IMPLEMENTED                                                                                                                                                                                                                                                                                                                                                             |
| `kubernetes.accounts[].kinds`                                                                                                                                               | []string          | empty                   | If not empty, only kinds in the list will be cached.                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| `kubernetes.accounts[].omitKinds`                                                                                                                                           | []string          | empty                   | List of kinds not to cache                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| `kubernetes.accounts[].metrics`                                                                                                                                             | boolean           | false                   | When true, sends pod metrics back to Spinnaker every                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| `kubernetes.accounts[].permissions`                                                                                                                                         | map               | empty                   | Same meaning as `permissions` in Clouddriver: under `READ` and `WRITE` list of roles authorized.                                                                                                                                                                                                                                                                                                                                                                                                |
| `kubernetes.accounts[].maxResumableResourceAgeMs`                                                                                                                           | integer           | 300000 (5m)             | When connecting, kubesvc asks Clouddriver for the latest resource version known per resource that is not older than that setting.<br><br>The resource version is used to resume the watch without first doing a list - saving memory and time. There’s no guarantee that the resource version is still known. If not “remembered” by the Kubernetes API server, a `list`  call will be used.<br><br>https://kubernetes.io/docs/reference/using-api/api-concepts/#efficient-detection-of-changes |
| `kubernetes.accounts[].onlySpinnakerManaged`                                                                                                                                | boolean           | false                   | Only return Spinnaker managed resources<br>NOT IMPLEMENTED in Kubesvc but added to clouddriver see `kubesvc.runtime.defaults.onlySpinnakerManaged`                                                                                                                                                                                                                                                                                                                                              |
| `server.host`                                                                                                                                                               | string            | localhost               | hostname of the server health check                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| `server.port`                                                                                                                                                               | integer           | 8082                    | port of the server health check                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| `server.ssl.enabled`, `server.ssl.certFile`, `server.ssl.keyFile`, `server.ssl.keyPassword`, `server.ssl.caCertFile`, `server.ssl.keyFilePassword`, `server.ssl.clientAuth` |                   |                         | Various options to control TLS config. Don’t bother, it’s just for the health endpoint.                                                                                                                                                                                                                                                                                                                                                                                                         |
| `prometheus.enabled`                                                                                                                                                        | boolean           | false                   | Enable Prometheus handler                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| `prometheus.port`                                                                                                                                                           | integer           | 8008                    | Port to expose Prometheus metrics on. Responds to both `/metrics` (standard) and `/prometheus_metrics` (Spinnaker default)                                                                                                                                                                                                                                                                                                                                                                      |
| `tasks.totalBudget`                                                                                                                                                         | integer           | 0                       | If > 0, limits the number of tasks that can be started. Tasks have different cost. Watches are considered free because they are part of the normal operations of Kubesvc.                                                                                                                                                                                                                                                                                                                       |
| `tasks.budgetPerAccount`                                                                                                                                                    | integer           | 0                       | Same as above but per account. If both settings are provided, they’re both checked.                                                                                                                                                                                                                                                                                                                                                                                                             |
| `tasks.queueCheckFrequencyMs`                                                                                                                                               | integer           | 2000                    | Frequency at which Kubesvc will check for new tasks to launch. Once launched a task is not stopped until explicitly requested (account unregistered or connection to Spinnaker lost)                                                                                                                                                                                                                                                                                                            |
| `certFile`                                                                                                                                                                  | string            | None                    | Client certificate to use when connecting to Spinnaker. If connecting to Buddy (dev mode) or the cert file is not provided, the connection to Spinnaker will be insecure.<br><br>Not required but strongly encouraged.                                                                                                                                                                                                                                                                          |
| `pprof.enabled`                                                                                                                                                             | boolean           | false                   | Enable pprof endpoint. Useful for troubleshooting, slowness, memory leaks, and more!<br>https://github.com/google/pprof/blob/master/doc/README.md                                                                                                                                                                                                                                                                                                                                               |
| `pprof.port`                                                                                                                                                                | integer           | 6060                    | Port on which to respond to pprof requests                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| `secrets.vault.*`                                                                                                                                                           | object            | none                    | Vault configuration - common with other Go services                                                                                                                                                                                                                                                                                                                                                                                                                                             |

