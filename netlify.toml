# Hugo build configuration for Netlify
# (https://gohugo.io/hosting-and-deployment/hosting-on-netlify/#configure-hugo-version-in-netlify)
# Default build settings

[build]
# This default build command adds the robots noindex directive to the site headers.
# It is turned off for only for the production site by using [context.master] below
# DO NOT REMOVE THIS
publish = "public"
functions = "functions"
command = "git submodule update --init --recursive --depth 1 && make non-production-build"

[build.environment]
HUGO_VERSION = "0.74.3"
NODE_VERSION= "10.20.0"
RUBY_VERSION = "2.7.1"
HUGO_THEME = "docsy"

[context.production.environment]
HUGO_BASEURL = "https://docs.armory.io/"
HUGO_ENV = "production"
HUGO_ENABLEGITINFO = "true"

[context.deploy-preview]
command = "git submodule update --init --recursive --depth 1 && make deploy-preview"

[context.branch-deploy]
command = "git submodule update --init --recursive --depth 1 && make deploy-preview"

[context.master]
# This context is triggered by the `master` branch and allows search indexing
# DO NOT REMOVE THIS (contact @kubernetes/sig-docs-leads)
publish = "public"
command = "git submodule update --init --recursive --depth 1 && make production-build"


# section redirects
[[redirects]]
  from = "/overview/*"
  to = "/docs/overview/:splat"
  status = 301
  force = false

[[redirects]]
  from = "/halyard-release-notes/*"
  to = "/docs/release-notes/rn-armory-halyard/"
  status = 301
  force = false

[[redirects]]
  from = "/release-notes/*"
  to = "/docs/release-notes/rn-armory-spinnaker/"
  status = 301
  force = false

[[redirects]]
  from = "/spinnaker/*"
  to = "/docs/spinnaker/:splat"
  status = 301
  force = false

[[redirects]]
  from = "/operator_reference/*"
  to = "/docs/operator-reference/:splat"
  status = 301
  force = false

[[redirects]]
  from = "/spinnaker-user-guides/*"
  to = "/docs/spinnaker-user-guides/:splat"
  status = 301
  force = false

[[redirects]]
  from = "/spinnaker-install-admin-guides/*"
  to = "/docs/spinnaker-install-admin-guides/:splat"
  status = 301
  force = false

[[redirects]]
  from = "/glossary/glossary"
  to = "/docs/overview/glossary/"
  status = 301
  force = false

[[redirects]]
  from =  "/docs/spinnaker-install-admin-guides/installation/*"
  to = "/docs/installation/guide/:splat"
  status = 301
  force = false

[[redirects]]
  from =  "/docs/operator-reference/*"
  to = "/docs/installation/operator-reference/:splat"
  status = 301
  force = false

[[redirects]]
  from = "/docs/installation/armory-agent/agent-options/"
  to = "/docs/armory-admin/armory-agent/"
  force = true


[[plugins]]
package = "@netlify/plugin-sitemap"

  [plugins.inputs]
  buildDir = "public"
